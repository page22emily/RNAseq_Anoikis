---
title: "Hallmark_Comparisons"
output: html_document
date: "2023-03-01"
---

This is to define the differences in the Hallmarks found in from clusterprofiler. 
Because of the hypothesis correction (and to simplify why the hallmarks were picked vs not),
I am using the results table where the p value is set to 1 as the cutoff. 
This will include ALL of the hallmarks so that we can see what is happening even w/o a 
significant p value 

used a normalized enrichment score and adjusted p values 

Figures needed: 
Bar graphs of the enrichment scores and time points for each cell line 
Correlation between OV90 and CAOV3 DEGS driving the hallmarks?
Correlation between OV90 and CAOV3 hallmarks? with leading edge or enrichment score? 

Set Up: 
/Users/emilypage/Documents/Mythreye_Lab/anoikis/Hallmarks

OV90
```{r}
OV90TP01 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_OV90/OV90_gse_0_vs_1_1k_perm_pval_1_cutoff_BH.csv")
OV90TP04 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_OV90/OV90_gse_0_vs_4_1k_perm_pval_1_cutoff_BH.csv")
OV90TP06 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_OV90/OV90_gse_0_vs_6_1k_perm_pval_1_cutoff_BH.csv")
OV90TP07 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_OV90/OV90_gse_0_vs_7_1k_perm_pval_1_cutoff_BH.csv")
OV90TP17 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_OV90/OV90_gse_1_vs_7_1k_perm_pval_1_cutoff_BH.csv")
```

```{r}
OV90TP01 <- OV90TP01[order(OV90TP01$X),]
OV90TP04 <- OV90TP04[order(OV90TP04$X),]
OV90TP06 <- OV90TP06[order(OV90TP06$X),]
OV90TP07 <- OV90TP07[order(OV90TP07$X),]
OV90TP17 <- OV90TP17[order(OV90TP17$X),]
```

```{r}
OV90_enrich <- as.data.frame(OV90TP01$X)
OV90_enrich$P0_vs_P1_enrich <- OV90TP01$NES
OV90_enrich$P0_vs_P6_enrich <- OV90TP06$NES
OV90_enrich$P0_vs_P7_enrich <- OV90TP07$NES
OV90_enrich$P1_vs_P7_enrich <- OV90TP17$NES
OV90_enrich$P0_vs_P1_p_val <- OV90TP01$p.adjust
OV90_enrich$P0_vs_P6_p_val <- OV90TP06$p.adjust
OV90_enrich$P0_vs_P7_p_val <- OV90TP07$p.adjust
OV90_enrich$P1_vs_P7_p_val <- OV90TP17$p.adjust
```

CAOV3
```{r}
CAOV3TP01 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_CAOV3/CAOV3_gse_0_vs_1_1k_perm_pval_1_cutoff_BH.csv")
CAOV3TP06 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_CAOV3/CAOV3_gse_0_vs_6_1k_perm_pval_1_cutoff_BH.csv")
CAOV3TP07 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_CAOV3/CAOV3_gse_0_vs_7_1k_perm_pval_1_cutoff_BH.csv")
CAOV3TP17 <- read.csv("~/Documents/Mythreye_Lab/anoikis/Hallmarks/Hallmarks_CAOV3/CAOV3_gse_1_vs_7_1k_perm_pval_1_cutoff_BH.csv")
CAOV3TP01 <- CAOV3TP01[order(CAOV3TP01$X),]
CAOV3TP06 <- CAOV3TP06[order(CAOV3TP06$X),]
CAOV3TP07 <- CAOV3TP07[order(CAOV3TP07$X),]
CAOV3TP17 <- CAOV3TP17[order(CAOV3TP17$X),]
```

```{r}
CAOV3_enrich <- as.data.frame(CAOV3TP01$X)
CAOV3_enrich$P0_vs_P1_enrich <- CAOV3TP01$NES
CAOV3_enrich$P0_vs_P6_enrich <- CAOV3TP06$NES
CAOV3_enrich$P0_vs_P7_enrich <- CAOV3TP07$NES
CAOV3_enrich$P1_vs_P7_p_enrich <- CAOV3TP07$NES
CAOV3_enrich$P0_vs_P1_p_val <- CAOV3TP01$p.adjust
CAOV3_enrich$P0_vs_P6_p_val <- CAOV3TP06$p.adjust
CAOV3_enrich$P0_vs_P7_p_val <- CAOV3TP07$p.adjust
CAOV3_enrich$P1_vs_P7_p_val <- CAOV3TP17$p.adjust
```

```{r}
OV90_enrich_enrich_t <- t(OV90_enrich)
COV3_enrich_t <- t(CAOV3_enrich)
```

Plot 1: Bar Graph for OV90 
```{r}
library(ggplot2)
library(tibble)
library(tidyr)
```

Simple Version first 
```{r}
x <- OV90TP01$enrichmentScore
y <- OV90TP01$X
ggplot(OV90TP01, aes(x = x, y = y)) + geom_col()
```
```{r}
Ov90 <- OV90_enrich[ , 1:5]
Ov90_fix <- pivot_longer(Ov90, col= 2:5, names_to = "Time_Point", values_to = "enrichment_score")
```


ggplot(data, aes(fill=condition, y=value, x=specie)) + 
    geom_bar(position="dodge", stat="identity")
```{r}
x= Ov90_fix$enrichment_score
y= Ov90_fix$`OV90TP01$X`
condition= Ov90_fix$Time_Point
fill = c("P0_vs_P1_enrich" = "blue", "P0_vs_P6_enrich"= "green", "P0_vs_P7_enrich"= "red", "P1_vs_P7_enrich"= "yellow")
ggplot(Ov90_fix, aes(x = x, y = y, fill=condition)) + geom_bar(position="dodge", stat="identity") + theme(text = element_text(size = 5))
```
```{r}
ggsave( "~/Desktop/OV90_Hallmarks.tiff", plot = last_plot())
```

```{r}
CAOV3 <- CAOV3_enrich[ , 1:5]
```


```{r}
CAOV3_fix <- pivot_longer(CAOV3, col= 2:5, names_to = "Time_Point", values_to = "enrichment_score")
```


```{r}
x= CAOV3_fix$enrichment_score
y= CAOV3_fix$`CAOV3TP01$X`
condition= CAOV3_fix$Time_Point
fill = c("P0_vs_P1_enrich" = "blue", "P0_vs_P6_enrich"= "green", "P0_vs_P7_enrich"= "red", "P1_vs_P7_enrich"= "yellow")
ggplot(Ov90_fix, aes(x = x, y = y, fill=condition)) + geom_bar(position="dodge", stat="identity") + theme(text = element_text(size = 5))
```


```{r}
ggsave( "~/Desktop/CAOV3_Hallmarks.tiff", plot = last_plot())
```

#significant hallmarks only (based on p val)
```{r}
.rowNamesDF(OV90_enrich, make.names=TRUE) <- OV90_enrich$`OV90TP01$X`
sig1 <- rownames(OV90_enrich[OV90_enrich$P0_vs_P1_p_val<= .25,])
sig2 <- rownames(OV90_enrich[OV90_enrich$P0_vs_P6_p_val<= .25,])
sig3 <- rownames(OV90_enrich[OV90_enrich$P0_vs_P7_p_val<= .25,])                 
sig4 <- rownames(OV90_enrich[OV90_enrich$P1_vs_P7_p_val<= .25,])                   
significant_hallmarks <- c(sig1, sig2, sig3, sig4)
OV90_sign <- Ov90_fix[Ov90_fix$`OV90TP01$X` %in% significant_hallmarks,]
```

```{r}
x= OV90_sign$enrichment_score
y= OV90_sign$`OV90TP01$X`
condition= OV90_sign$Time_Point
fill = c("P0_vs_P1_enrich" = "blue", "P0_vs_P6_enrich"= "green", "P0_vs_P7_enrich"= "red", "P1_vs_P7_enrich"= "yellow")
ggplot(OV90_sign, aes(x = x, y = y, fill=condition)) + geom_bar(position="dodge", stat="identity") + theme(text = element_text(size = 5)) + theme(panel.background = element_blank()) + theme(axis.line = element_line(colour = "black"))
```

```{r}
ggsave( "~/Desktop/OV90_sign_Hallmarks.tiff", plot = last_plot())
```

```{r}
.rowNamesDF(CAOV3_enrich, make.names=TRUE) <- CAOV3_enrich$`CAOV3TP01$X`
sig1 <- rownames(CAOV3_enrich[CAOV3_enrich$P0_vs_P1_p_val<= .25,])
sig2 <- rownames(CAOV3_enrich[CAOV3_enrich$P0_vs_P6_p_val<= .25,])
sig3 <- rownames(CAOV3_enrich[CAOV3_enrich$P0_vs_P7_p_val<= .25,])                 
sig4 <- rownames(CAOV3_enrich[CAOV3_enrich$P1_vs_P7_p_val<= .25,])                   
significant_hallmarks <- c(sig1, sig2, sig3, sig4)
CAOV3_sign <- CAOV3_fix[CAOV3_fix$`CAOV3TP01$X` %in% significant_hallmarks,]
```

```{r}
x= CAOV3_sign$enrichment_score
y= CAOV3_sign$`CAOV3TP01$X`
condition= CAOV3_sign$Time_Point
fill = c("P0_vs_P1_enrich" = "blue", "P0_vs_P6_enrich"= "green", "P0_vs_P7_enrich"= "red", "P1_vs_P7_enrich"= "yellow")
ggplot(CAOV3_sign, aes(x = x, y = y, fill=condition)) + geom_bar(position="dodge", stat="identity") + theme(text = element_text(size = 5)) + theme(panel.background = element_blank(), panel.grid.major= element_line()) + theme(axis.line = element_line(colour = "black"))
```

```{r}
ggsave( "~/Desktop/CAOV3_sign_Hallmarks.tiff", plot = last_plot())
```

#Overlap Correlation with multiple time points 
```{r}
P0_P6_combined <- as.data.frame(OV90_enrich$`OV90TP01$X`)
P0_P6_combined$OV90 <- OV90_enrich$P0_vs_P6_enrich
P0_P6_combined$CAOV3 <- CAOV3_enrich$P0_vs_P6_enrich
colnames(P0_P6_combined) <- c("Hallmarks", "OV90", "CAOV3")
```

```{r}
Three <- P0_P6_combined
ggplot(data = Three, aes(x = OV90, y = CAOV3, shape=factor(Hallmarks), fill=factor(Hallmarks), col=factor(Hallmarks))) + geom_point(alpha = 0.5, size=14, stroke=1.4) + scale_shape_manual(values=rep(c(21:25), times=10)) + geom_vline(xintercept = 0, 
                color = "black", linewidth=1.5) + geom_hline(yintercept=0, color = "black", linewidth=1.5) + theme(legend.key.size = unit(3, 'cm'), legend.text = element_text(size=19), legend.title=element_blank()) + guides(color=guide_legend(ncol=2)) + guides(shape=guide_legend(ncol=2)) 
ggsave("~/Desktop/P0_P6_Hallmarks.tiff", plot = last_plot(), width= 49, height= 30, unit= "in")
```
```{r}
P0_P1_combined <- as.data.frame(OV90_enrich$`OV90TP01$X`)
P0_P1_combined$OV90 <- OV90_enrich$P0_vs_P1_enrich
P0_P1_combined$CAOV3 <- CAOV3_enrich$P0_vs_P1_enrich
colnames(P0_P1_combined) <- c("Hallmarks", "OV90", "CAOV3")
```

```{r}
Three <- P0_P1_combined
ggplot(data = Three, aes(x = OV90, y = CAOV3, shape=factor(Hallmarks), fill=factor(Hallmarks), col=factor(Hallmarks))) + geom_point(alpha = 0.5, size=14, stroke=1.4) + scale_shape_manual(values=rep(c(21:25), times=10)) + geom_vline(xintercept = 0, 
                color = "black", linewidth=1.5) + geom_hline(yintercept=0, color = "black", linewidth=1.5) + theme(legend.key.size = unit(3, 'cm'), legend.text = element_text(size=19), legend.title=element_blank()) + guides(color=guide_legend(ncol=2)) + guides(shape=guide_legend(ncol=2)) 
ggsave("~/Desktop/P0_P1_Hallmarks.tiff", plot = last_plot(), width= 49, height= 30, unit= "in")
```
```{r}
P1_P7_combined <- as.data.frame(OV90_enrich$`OV90TP01$X`)
P1_P7_combined$OV90 <- OV90_enrich$P1_vs_P7_enrich
P1_P7_combined$CAOV3 <- CAOV3_enrich$P1_vs_P7_p_enrich
colnames(P1_P7_combined) <- c("Hallmarks", "OV90", "CAOV3")
```

```{r}
Three <- P1_P7_combined
ggplot(data = Three, aes(x = OV90, y = CAOV3, shape=factor(Hallmarks), fill=factor(Hallmarks), col=factor(Hallmarks))) + geom_point(alpha = 0.5, size=14, stroke=1.4) + scale_shape_manual(values=rep(c(21:25), times=10)) + geom_vline(xintercept = 0, 
                color = "black", linewidth=1.5) + geom_hline(yintercept=0, color = "black", linewidth=1.5) + theme(legend.key.size = unit(3, 'cm'), legend.text = element_text(size=19), legend.title=element_blank()) + guides(color=guide_legend(ncol=2)) + guides(shape=guide_legend(ncol=2)) 
ggsave("~/Desktop/P1_P7_Hallmarks.tiff", plot = last_plot(), width= 49, height= 30, unit= "in")
```

```{r}
P0_P7_combined <- as.data.frame(OV90_enrich$`OV90TP01$X`)
P0_P7_combined$OV90 <- OV90_enrich$P0_vs_P7_enrich
P0_P7_combined$CAOV3 <- CAOV3_enrich$P0_vs_P7_enrich
colnames(P0_P7_combined) <- c("Hallmarks", "OV90", "CAOV3")
```

```{r}
Three <- P0_P7_combined
ggplot(data = Three, aes(x = OV90, y = CAOV3, shape=factor(Hallmarks), fill=factor(Hallmarks), col=factor(Hallmarks))) + geom_point(alpha = 0.5, size=14, stroke=1.4) + scale_shape_manual(values=rep(c(21:25), times=10)) + geom_vline(xintercept = 0, 
                color = "black", linewidth=1.5) + geom_hline(yintercept=0, color = "black", linewidth=1.5) + theme(legend.key.size = unit(3, 'cm'), legend.text = element_text(size=19), legend.title=element_blank()) + guides(color=guide_legend(ncol=2)) + guides(shape=guide_legend(ncol=2)) 
ggsave("~/Desktop/P0_P7_Hallmarks.tiff", plot = last_plot(), width= 49, height= 30, unit= "in") 
```



